{% extends "wildlife/base.html" %}

{% block title %}Gallery{% endblock %}

{% block content %}
<h1>Public Gallery</h1>

<div style="margin: 10px 0 18px 0;">
  <button id="toggle-params-btn" class="btn" type="button">
    Hide details
  </button>
</div>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const btn = document.getElementById("toggle-params-btn");
    const body = document.body;

    const hideParams = localStorage.getItem("hidePhotoParams") === "true";
    if (hideParams) {
      body.classList.add("hide-params");
      btn.textContent = "Show details";
    }

    btn.addEventListener("click", () => {
      body.classList.toggle("hide-params");
      const isHidden = body.classList.contains("hide-params");
      btn.textContent = isHidden ? "Show details" : "Hide details";
      localStorage.setItem("hidePhotoParams", isHidden);
    });
  });
</script>

{% if photos_with_boxes %}
  <div style="display:flex; flex-wrap:wrap; gap:16px;">
    {% for item in photos_with_boxes %}
      {% with photo=item.photo %}
      <div class="photo-card is-clickable"
           data-edit-url="{% url 'wildlife:photo_detail' photo.id %}">
        <div class="photo-title">
          {{ photo.image.name|default:"Photo" }}
        </div>

        {% if photo.image %}
          <div class="photo-wrapper show-boxes">
            <img src="{{ photo.image.url }}" class="photo-zoom" alt="photo {{ photo.id }}">
            {% for box in item.detection_boxes %}
              <div class="det-box{% if box.is_person %} det-box-person{% endif %}"
                   style="
                     left: {{ box.left }}%;
                     top: {{ box.top }}%;
                     width: {{ box.width }}%;
                     height: {{ box.height }}%;
                   ">
              </div>
            {% endfor %}
          </div>
        {% endif %}

        <div class="photo-params">
          <strong>Model parameters:</strong>
          <ul>
            <li>Camera ID:
              {% if photo.camera %}
                {{ photo.camera.name }}
              {% else %}
                Unknown
              {% endif %}
            </li>

            <li>Date/time:
              {% if photo.date_taken %}
                {{ photo.date_taken }}{% if photo.time_taken %} {{ photo.time_taken }}{% endif %}
              {% else %}
                {{ photo.uploaded_at }}
              {% endif %}
            </li>

            <li>Temperature:
              {% if photo.temperature %}
                {{ photo.temperature }}&deg;C
              {% else %}
                —
              {% endif %}
            </li>
            <li>Pressure:
              {% if photo.pressure %}
                {{ photo.pressure }} inHg
              {% else %}
                —
              {% endif %}
            </li>
          </ul>
        </div>

        {# Unpublish handled on the card detail page for researchers. #}
      </div>
      {% endwith %}
    {% endfor %}
  </div>
{% else %}
  <p>No photos yet.</p>
{% endif %}
{% endblock %}
